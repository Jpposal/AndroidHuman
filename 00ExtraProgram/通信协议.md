# 通讯协议

**注：**
输出的数据都是带正负的，需要做符号位处理。

## 指令操作步骤

(注：读取指令不用发送解锁，写指令必须解锁才可以设置修改内容)

串口发送指令必须要在10S内完成，否则会自动上锁，为避免自动上锁，可以先进行以下步骤。

1. 输入解锁指令 (0XFF 0XAA 0X69 0X88 0XB5，0X表示16进制)
2. 输入需要修改或读取数据的指令
3. 保存指令 (0XFF 0XAA 0X00 0X00 0X00)

## 寄存器表

| ADDR (Hex) | ADDR (Dec) | REGISTER NAME | FUNCTION | SERIAL I/F | Bit Description / Layout |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 00 | 00 | SAVE | 保存/重启/恢复出厂 | R/W | SAVE[15:0] |
| 01 | 01 | CALSW | 校准模式 | R/W | CALSW[3:0] |
| 02 | 02 | RSW | 输出内容 | R/W | Bit9:GSA Bit8:QUATER Bit7:VELOCITY Bit6:GPS Bit5:PRESS Bit4:PORT Bit3:MAG Bit2:ANGLE Bit1:GYRO Bit0:TIME |
| 03 | 03 | RRATE | 输出速率 | R/W | RRATE[3:0] |
| 04 | 04 | BAUD | 串口波特率 | R/W | BAUD[3:0] |
| 05 | 05 | AXOFFSET | 加速度X零偏 | R/W | AXOFFSET[15:0] |
| 06 | 06 | AYOFFSET | 加速度Y零偏 | R/W | AYOFFSET[15:0] |
| 07 | 07 | AZOFFSET | 加速度Z零偏 | R/W | AZOFFSET[15:0] |
| 08 | 08 | GXOFFSET | 角速度X零偏 | R/W | GXOFFSET[15:0] |
| 09 | 09 | GYOFFSET | 角速度Y零偏 | R/W | GYOFFSET[15:0] |
| 0A | 10 | GZOFFSET | 角速度Z零偏 | R/W | GZOFFSET[15:0] |
| 0B | 11 | HXOFFSET | 磁场X零偏 | R/W | HXOFFSET[15:0] |
| 0C | 12 | HYOFFSET | 磁场Y零偏 | R/W | HYOFFSET[15:0] |
| 0D | 13 | HZOFFSET | 磁场Z零偏 | R/W | HZOFFSET[15:0] |
| 0E | 14 | D0MODE | D0引脚模式 | R/W | D0MODE[3:0] |
| 0F | 15 | D1MODE | D1引脚模式 | R/W | D1MODE[3:0] |
| 10 | 16 | D2MODE | D2引脚模式 | R/W | D2MODE[3:0] |
| 11 | 17 | D3MODE | D3引脚模式 | R/W | D3MODE[3:0] |
| 1A | 26 | IICADDR | 设备地址 | R/W | IICADDR[7:0] |
| 1B | 27 | LEDOFF | 关闭LED灯 | R/W | LEDOFF |
| 1C | 28 | MAGRANGX | 磁场X校准范围 | R/W | MAGRANGX[15:0] |
| 1D | 29 | MAGRANGY | 磁场Y校准范围 | R/W | MAGRANGY[15:0] |
| 1E | 30 | MAGRANGZ | 磁场Z校准范围 | R/W | MAGRANGZ[15:0] |
| 1F | 31 | BANDWIDTH | 带宽 | R/W | BANDWIDTH[3:0] |
| 20 | 32 | GYRORANGE | 陀螺仪量程 | R/W | GYRORANGE[3:0] |
| 21 | 33 | ACCRANGE | 加速度量程 | R/W | ACCRANGE[3:0] |
| 22 | 34 | SLEEP | 休眠 | R/W | SLEEP |
| 23 | 35 | ORIENT | 安装方向 | R/W | ORIENT |
| 24 | 36 | AXIS6 | 算法 | R/W | AXIS6 |
| 25 | 37 | FILTK | 动态滤波 | R/W | FILTK[15:0] |
| 26 | 38 | GPSBAUD | GPS波特率 | R/W | GPSBAUD[3:0] |
| 27 | 39 | READADDR | 读取寄存器 | R/W | READADDR[7:0] |
| 2A | 42 | ACCFILT | 加速度滤波 | R/W | ACCFILT[15:0] |
| 2D | 45 | POWONSEND | 指令启动 | R/W | POWONSEND[3:0] |
| 2E | 46 | VERSION | 版本号 | R | VERSION[15:0] |
| 30 | 48 | YYMM | 年月 | R/W | MONTH[15:8] YEAR[7:0] |
| 31 | 49 | DDHH | 日时 | R/W | HOUR[15:8] DAY[7:0] |
| 32 | 50 | MMSS | 分秒 | R/W | SECONDS[15:8] MINUTE[7:0] |
| 33 | 51 | MS | 毫秒 | R/W | MS[15:0] |
| 34 | 52 | AX | 加速度X | R | AX[15:0] |
| 35 | 53 | AY | 加速度Y | R | AY[15:0] |
| 36 | 54 | AZ | 加速度Z | R | AZ[15:0] |
| 37 | 55 | GX | 角速度X | R | GX[15:0] |
| 38 | 56 | GY | 角速度Y | R | GY[15:0] |
| 39 | 57 | GZ | 角速度Z | R | GZ[15:0] |
| 3A | 58 | HX | 磁场X | R | HX[15:0] |
| 3B | 59 | HY | 磁场Y | R | HY[15:0] |
| 3C | 60 | HZ | 磁场Z | R | HZ[15:0] |
| 3D | 61 | Roll | 横滚角 | R | Roll[15:0] |
| 3E | 62 | Pitch | 俯仰角 | R | Pitch[15:0] |
| 3F | 63 | Yaw | 航向角 | R | Yaw[15:0] |
| 40 | 64 | TEMP | 温度 | R | TEMP[15:0] |
| 41 | 65 | D0Status | D0引脚状态 | R | D0Status[15:0] |
| 42 | 66 | D1Status | D1引脚状态 | R | D1Status[15:0] |
| 43 | 67 | D2Status | D2引脚状态 | R | D2Status[15:0] |
| 44 | 68 | D3Status | D3引脚状态 | R | D3Status[15:0] |
| 45 | 69 | PressureL | 气压低16位 | R | PressureL[15:0] |
| 46 | 70 | PressureH | 气压高16位 | R | PressureH[15:0] |
| 47 | 71 | HeightL | 高度低16位 | R | HeightL[15:0] |
| 48 | 72 | HeightH | 高度高16位 | R | HeightH[15:0] |
| 49 | 73 | LonL | 经度低16位 | R | LonL[15:0] |
| 4A | 74 | LonH | 经度高16位 | R | LonH[15:0] |
| 4B | 75 | LatL | 纬度低16位 | R | LatL[15:0] |
| 4C | 76 | LatH | 纬度高16位 | R | LatH[15:0] |
| 4D | 77 | GPSHeight | GPS海拔 | R | GPSHeight[15:0] |
| 4E | 78 | GPSYAW | GPS航向角 | R | GPSYAW[15:0] |
| 4F | 79 | GPSVL | GPS地速低16位 | R | GPSVL[15:0] |
| 50 | 80 | GPSVH | GPS地速高16位 | R | GPSVH[15:0] |
| 51 | 81 | q0 | 四元数0 | R | q0[15:0] |
| 52 | 82 | q1 | 四元数1 | R | q1[15:0] |
| 53 | 83 | q2 | 四元数2 | R | q2[15:0] |
| 54 | 84 | q3 | 四元数3 | R | q3[15:0] |
| 55 | 85 | SVNUM | 卫星数 | R | SVNUM[15:0] |
| 56 | 86 | PDOP | 位置精度 | R | PDOP[15:0] |
| 57 | 87 | HDOP | 水平精度 | R | HDOP[15:0] |
| 58 | 88 | VDOP | 垂直精度 | R | VDOP[15:0] |
| 59 | 89 | DELAYT | 报警信号延时 | R/W | DELAYT[15:0] |
| 5A | 90 | XMIN | X轴角度报警最小值 | R/W | XMIN[15:0] |
| 5B | 91 | XMAX | X轴角度报警最大值 | R/W | XMAX[15:0] |
| 5C | 92 | BATVAL | 供电电压 | R | BATVAL[15:0] |
| 5D | 93 | ALARMPIN | 报警引脚映射 | R/W | X-ALARM[15:12] X+ALARM[11:8] Y-ALARM[7:4] Y+ALARM[3:0] |
| 5E | 94 | YMIN | Y轴角度报警最小值 | R/W | YMIN[15:0] |
| 5F | 95 | YMAX | Y轴角度报警最大值 | R/W | YMAX[15:0] |
| 61 | 97 | GYROCALITHR | 陀螺仪静止阈值 | R/W | GYROCALITHR[15:0] |
| 62 | 98 | ALARMLEVEL | 角度报警电平 | R/W | ALARMLEVEL[3:0] |
| 63 | 99 | GYROCALTIME | 陀螺仪自动校准时间 | R/W | GYROCALTIME[15:0] |
| 68 | 104 | TRIGTIME | 报警连续触发时间 | R/W | TRIGTIME[15:0] |
| 69 | 105 | KEY | 解锁 | R/W | KEY[15:0] |
| 6A | 106 | WERROR | 陀螺仪变化值 | R | WERROR[15:0] |
| 6B | 107 | TIMEZONE | GPS时区 | R/W | TIMEZONE[7:0] |
| 6E | 110 | WZTIME | 角速度连续静止时间 | R/W | WZTIME[15:0] |
| 6F | 111 | WZSTATIC | 角速度积分阈值 | R/W | WZSTATIC[15:0] |
| 74 | 116 | MODDELAY | 485数据应答延时 | R/W | |
| 79 | 121 | XREFROLL | 横滚角零位参考值 | R | XREFROLL[15:0] |
| 7A | 122 | YREFPITCH | 俯仰角零位参考值 | R | YREFPITCH[15:0] |
| 7F | 127 | NUMBERID1 | 设备编号1-2 | R | ID2[15:8] ID1[7:0] |
| 80 | 128 | NUMBERID2 | 设备编号3-4 | R | ID4[15:8] ID3[7:0] |
| 81 | 129 | NUMBERID3 | 设备编号5-6 | R | ID6[15:8] ID5[7:0] |
| 82 | 130 | NUMBERID4 | 设备编号7-8 | R | ID8[15:8] ID7[7:0] |
| 83 | 131 | NUMBERID5 | 设备编号9-10 | R | ID10[15:8] ID9[7:0] |
| 84 | 132 | NUMBERID6 | 设备编号11-12 | R | ID12[15:8] ID11[7:0] |
| 8F | 143 | | 报警输出时间 | R/W | 仅支持JY901L |
| 90 | 144 | | 震动唤醒阈值 | R/W | 仅支持JY901L |

## 协议格式

### 读格式

- 数据是按照16进制方式发送的，不是ASCII码。
- 每个数据分低字节和高字节依次传送，二者组合成一个有符号的short类型的数据。例如数据DATA1，其中DATA1L为低字节，DATA1H为高字节。转换方法如下：假设DATA1为实际的数据，DATA1H为其高字节部分，DATA1L为其低字节部分，
  那么：`DATA1 = (short)((short)DATA1H<<8|DATA1L)`。这里一定要注意DATA1H需要先强制转换为一个有符号的short类型的数据以后再移位，并且DATA1的数据类型也是有符号的short类型，这样才能表示出负数。

**数据帧格式：**

| 协议头 | 数据内容 | 数据低8位 | 数据高8位 | 数据低8位 | 数据高8位 | 数据低8位 | 数据高8位 | 数据低8位 | 数据高8位 | SUMCRC |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 0x55 | TYPE【1】 | DATA1L[7:0] | DATA1H[15:8] | DATA2L[7:0] | DATA2H[15:8] | DATA3L[7:0] | DATA3H[15:8] | DATA4L[7:0] | DATA4H[15:8] | SUMCRC【2】 |

**【1】TYPE(数据内容):**

| TYPE | 备注 |
| :--- | :--- |
| 0x50 | 时间 |
| 0x51 | 加速度 |
| 0x52 | 角速度 |
| 0x53 | 角度 |
| 0x54 | 磁场 |
| 0x55 | 端口状态 |
| 0x56 | 气压高度 |
| 0x57 | 经纬度 |
| 0x58 | 地速 |
| 0x59 | 四元数 |
| 0x5A | GPS定位精度 |
| 0x5F | 读取 |

**【2】SUMCRC(数据和校验):**

`SUMCRC = 0x55 + TYPE + DATA1L + DATA1H + DATA2L + DATA2H + DATA3L + DATA3H + DATA4L + DATA4H`

SUMCRC为char型，取校验和的低8位

---

### 时间输出

**数据帧格式：**

| 0x55 | 0x50 | YY | MM | DD | HH | MN | SS | MSL | MSH | SUM |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |

| 名称 | 描述 | 备注 |
| :--- | :--- | :--- |
| YY | 年 | |
| MM | 月 | |
| DD | 日 | |
| HH | 时 | |
| MN | 分 | |
| SS | 秒 | |
| MSL | 毫秒低8位 | 毫秒计算公式：毫秒=((MSH<<8)\|MSL) |
| MSH | 毫秒高8位 | |
| SUM | 校验和 | SUM=0x55+0x50+YY+MM+DD+HH+MN+SS+MSL+MSH |

---

### 加速度输出

**数据帧格式：**

| 0x55 | 0x51 | AxL | AxH | AyL | AyH | AzL | AzH | TL | TH | SUM |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |

| 名称 | 描述 | 备注 |
| :--- | :--- | :--- |
| AxL | 加速度X低8位 | X轴=((AxH<<8)\|AxL)/32768*16g (g为重力加速度，可取9.8m/s2) |
| AxH | 加速度X高8位 | |
| AyL | 加速度Y低8位 | Y轴=((AyH<<8)\|AyL)/32768*16g (g为重力加速度，可取9.8m/s2) |
| AyH | 加速度Y高8位 | |
| AzL | 加速度Z低8位 | Z轴=((AzH<<8)\|AzL)/32768*16g (g为重力加速度，可取9.8m/s2) |
| AzH | 加速度Z高8位 | |
| TL | 温度低8位 | 温度计算公式：温度=((TH<<8)\|TL)/100 ℃ |
| TH | 温度高8位 | |
| SUM | 校验和 | SUM=0x55+0x51+AxL+AxH+AyL+AyH+AzL+AzH+TL+TH |

---

### 角速度输出

**注：wt9011g4k的需要角速度计算是需要乘4000°/s的系数。**

**数据帧格式：**

| 0x55 | 0x52 | WxL | WxH | WyL | WyH | WzL | WzH | VolL | VolH | SUM |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |

| 名称 | 描述 | 备注 |
| :--- | :--- | :--- |
| WxL | 角速度X低8位 | 角速度X=((WxH<<8)\|WxL)/32768*2000°/s |
| WxH | 角速度X高8位 | |
| WyL | 角速度Y低8位 | 角速度Y=((WyH<<8)\|WyL)/32768*2000°/s |
| WyH | 角速度Y高8位 | |
| WzL | 角速度Z低8位 | 角速度Z=((WzH<<8)\|WzL)/32768*2000°/s |
| WzH | 角速度Z高8位 | |
| VolL | 电压低8位 | (非蓝牙产品，该数据无效) 电压计算公式：电压=((VolH<<8)\|VolL)/100 ℃ |
| VolH | 电压高8位 | |
| SUM | 校验和 | SUM=0x55+0x52+WxL+WxH+WyL+WyH+WzL+WzH+VolH+VolL |

---

### 角度输出

**数据帧格式：**

| 0x55 | 0x53 | RollL | RollH | PitchL | PitchH | YawL | YawH | VL | VH | SUM |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |

| 名称 | 描述 | 备注 |
| :--- | :--- | :--- |
| RollL | 滚转角X低8位 | 滚转角X=((RollH<<8)\|RollL)/32768*180(°) |
| RollH | 滚转角X高8位 | |
| PitchL | 俯仰角Y低8位 | 俯仰角Y=((PitchH<<8)\|PitchL)/32768*180(°) |
| PitchH | 俯仰角Y高8位 | |
| YawL | 偏航角Z低8位 | 偏航角Z=((YawH<<8)\|YawL)/32768*180(°) |
| YawH | 偏航角Z高8位 | |
| VL | 版本号低8位 | 版本号计算公式：版本号=(VH<<8)\|VL |
| VH | 版本号高8位 | |
| SUM | 校验和 | SUM=0x55+0x53+RollH+RollL+PitchH+PitchL+YawH+YawL+VH+VL |
